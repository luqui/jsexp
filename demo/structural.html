<html>
 <head>
  <script src="jquery.min.js"></script>
  <script src="../structural.js"></script>

  <style>
   .eatom { color: red }
   .selected { background: #fdd }
   .box { background: lightgreen }
  </style>

  <script>
$(function() {

var Exp_eplus_box = Exp_box('eplus', regexp_tokenizer({
    '\\d+': function(m) { 
        return Exp_eplus.make(Exp_eatom.make(m[0]), Exp_eplus_cont_box.make()) 
    }
}));

var Exp_eplus_cont_box = Exp_box('eplus', regexp_tokenizer({
    '': function(m) {
        return Exp_eplus_cont_box.make();
    },
    '\\+': function(m) {
        return Exp_eplus.make(Exp_plus_token.make(), Exp_eplus_box.make())
    }
}));

var Exp_E = new EClass({
    cls: 'E'
});

var Exp_eplus_single = new EClass({
    cls: 'eplus'
});

var Exp_eplus = new EClass({
    cls: 'eplus'
});

var Exp_plus_token = new EClass({
    cls: 'plus_token',
    render: function() {
        return [text_node(' + ')]
    }
});

var Exp_eatom = new EClass({
    cls: 'eatom'
});



var container = elt('div');
$(document.body).append(container);

var zipper = new Zipper([], Exp_eplus_box.make());

var update = function(z) {
    if (!z) return;
    zipper = z;
    container.empty();
    container.append(elt('pre', {}, render_zipper(z)));
};

update(zipper);

$(document.body).keydown(function(e) {
    if (37 == e.which) { // left
        update(zipper.left());
    }
    else if (38 == e.which) { // up
        update(zipper.up());
    }
    else if (39 == e.which) { // right
        update(zipper.right());
    }
    else if (40 == e.which) { // down
        update(zipper.down(0));
    }
    else {
        //console.log(e.which, e.charCode);
    }
});

$(document.body).keypress(function(e) {
    if (typeof(zipper.expr) !== 'string') {
        var ch = String.fromCharCode(e.charCode);
        var tokresult = zipper.expr.head.parse(zipper.expr)(ch);
        if (tokresult) {
            update(new Zipper(zipper.contexts, tokresult[0]));
        }
    }
});

});
  </script>
 </head>
 <body>
 </body>
</html>
