<html>
 <head>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.1/jquery.min.js"></script>
  <script src="../structural.js"></script>

  <style>
   .eatom { color: red }
   .selected { background: #fdd }
  </style>

  <script>
$(function() {

var container = elt('div');
$(document.body).append(container);

var update = function(z) {
    container.empty();
    container.append(elt('pre', {}, render_zipper(z)));
};

var parser = {
    tokenizer: map_tokenizer(flatten, multi_tokenizer(regexp_tokenizer({
        '\\d+': function(m) { return [Exp_eatom.make()] },
        '\\s+': function(m) { return [] }
    }))),
    parser: function(toks) {
        return toks;
    }
};

var zipper =
/*
    new Zipper([],  
        Exp_E.make(
            Exp_eplus.make(
                Exp_eatom.make(),
                Exp_eatom.make())));
*/
    new Zipper([], Exp_unassembled(parser).make());

update(zipper);

$(document.body).keydown(function(e) {
    if (37 == e.which) { // left
        update(zipper = zipper.left());
    }
    else if (38 == e.which) { // up
        update(zipper = zipper.up());
    }
    else if (39 == e.which) { // right
        update(zipper = zipper.right());
    }
    else if (40 == e.which) { // down
        update(zipper = zipper.down(0));
    }
    else {
        console.log(e.which, e.charCode);
    }
});

$(document.body).keypress(function(e) {
    if (e.charCode != 0 && zipper.exp.head.keypress) {
        update(zipper = zipper.exp.head.keypress(String.fromCharCode(e.charCode), zipper));
    }
});

});
  </script>
 </head>
 <body>
 </body>
</html>
