<html>
 <head>
  <script src="jquery.min.js"></script>
  <script src="../structural.js"></script>

  <style>
   .eatom { color: red }
   .selected { background: #fdd }
   .box { background: lightgreen }
  </style>

  <script>
$(function() {

var Exp_eplus_box = Infix_assoc_box('eplus', 
    'eatom', regexp_tokenizer({
        '\\d+': function(m) {
            return Exp_eatom.make(m[0]);
        }
    }),
    'plus_token', regexp_tokenizer({
        '\\+': function(m) {
            return Exp_plus_token.make()
        }
    }));

var Exp_plus_token = new EClass({
    cls: 'plus_token',
    render: function() {
        return [text_node(' + ')]
    }
});

var Exp_eatom = new EClass({
    cls: 'eatom'
});



var container = elt('div');
$(document.body).append(container);

var zipper = new Zipper([], Exp_eplus_box.make());

var update = function(z) {
    if (!z) return;
    zipper = z;
    container.empty();
    container.append(elt('pre', {}, render_zipper(z)));
};

update(zipper);

$(document.body).keydown(function(e) {
    var head = typeof(zipper.expr) === 'string' ? new EClass({}) : zipper.expr.head;
    if (37 == e.which) { // left
        update(head.nav_left(zipper));
    }
    else if (38 == e.which) { // up
        update(head.nav_up(zipper));
    }
    else if (39 == e.which) { // right
        update(head.nav_right(zipper));
    }
    else if (40 == e.which) { // down
        update(head.nav_down(zipper));
    }
    else {
        //console.log(e.which, e.charCode);
    }
});

$(document.body).keypress(function(e) {
    if (typeof(zipper.expr) !== 'string') {
        var ch = String.fromCharCode(e.charCode);
        var tokresult = zipper.expr.head.parse(zipper.expr)(ch);
        if (tokresult) {
            update(new Zipper(zipper.contexts, tokresult[0]));
        }
    }
});

});
  </script>
 </head>
 <body>
 </body>
</html>
