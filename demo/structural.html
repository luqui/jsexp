<html>
 <head>
  <script src="jquery.min.js"></script>
  <script src="../StructuralFramework.js"></script>
  <script src="../StructuralEditor.js"></script>

  <style>
   .eatom { color: red }
   .selected { background: #fdd }
   .box { background: lightgreen }
  </style>

  <script>

// main : jQuery * StructuralFramework * (top_node -> StructuralEditor) -> Module
var main = function($, SF, SE) {

// CodeCatalog Snippet http://www.codecatalog.net/323/2/
var for_kv = function(object, body) {
    for (var k in object) {
        if (object.hasOwnProperty(k)) {
            body(k, object[k]);
        }
    }
};
// End CodeCatalog Snippet


// CodeCatalog Snippet http://www.codecatalog.net/378/2/
var regexp_tokenizer = function(tokens) { 
    return function(str) {
        var bestMatch = null;
        var bestFunc = null; 
        for_kv(tokens, function(k,v) {
            var m = new RegExp('^' + k)(str);
            if (m && (!bestMatch || m[0].length > bestMatch[0].length)) {
                bestMatch = m;
                bestFunc = v;
            }
        });

        // don't match the whole string in case we are in the middle of typing a token
        // we use \0 to mean "eof" so this will pass.
        if (bestFunc && bestMatch[0].length < str.length) {
            return [bestFunc(bestMatch), str.slice(bestMatch[0].length)];
        }
        else {
            return null;
        }
    }
};
// End CodeCatalog Snippet

// CodeCatalog Snippet http://www.codecatalog.net/256/1/
var text_node = function(text) { return document.createTextNode(text) };
// End CodeCatalog Snippet


var Exp_eplus_box = SF.Infix_assoc_box('eplus', 
    'eatom', regexp_tokenizer({
        '\\d+': function(m) {
            return Exp_eatom.make(m[0]);
        }
    }),
    'plus_token', regexp_tokenizer({
        '\\+': function(m) {
            return Exp_plus_token.make()
        }
    }));

var Exp_plus_token = new SF.EClass({
    cls: 'plus_token',
    render: function() {
        return [text_node(' + ')]
    }
});

var Exp_eatom = new SF.EClass({
    cls: 'eatom'
});

var top_node  = Exp_eplus_box.make();
var editor = SE(top_node, $(document));

$(document.body).append(editor);

};


jQuery(function() {
    var SF = StructuralFramework(jQuery);
    main(
        jQuery, 
        SF,
        function(top_node, event_node) { 
            return StructuralEditor(jQuery, SF, top_node, event_node) 
        }
    );
});


  </script>
 </head>
 <body>
 </body>
</html>
