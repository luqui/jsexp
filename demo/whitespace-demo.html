<html>
<head> 
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js"></script>
<script src="codemirror.js"></script>
<link rel="stylesheet" href="codemirror.css" />

<style>
span.line { background: lightgray }
span.indent { background: lightgreen }
span.outdent { background: pink }
span.samedent { background: yellow }
span.error { background: red }
</style>

<script>
$(function() { 

CodeMirror.defineMode("alty", function(conifg, parserConfig) {
    return {
        startState: function() {
            return { indent: [0], sol: true }
        },

        token: function(stream, state) {
            if (stream.sol() && state.sol) {
                state.sol = false;
                var m = stream.match(/^\s+/);
                var indent = m ? m[0].length : 0;
                var istate = state.indent[state.indent.length-1];
                if (indent > istate) {
                    state.indent.push(indent);
                    return 'indent';
                }
                else if (indent < istate) {
                    while (indent < state.indent[state.indent.length-1]) {
                        state.indent.pop();
                    }
                    if (indent == state.indent[state.indent.length-1]) {
                        return 'outdent';
                    }
                    else {
                        return 'error';
                    }
                }
                else {
                    return 'samedent';
                }
            }
            else {
                stream.eatWhile(/^.*/);
                state.sol = true;
                return 'line';
            }
        },
        
        indent: function(state, textAfter) {
            return state.indent[state.indent.length-1];
        },
    }
});

var showLineCh = function(linech) {
    return linech.line + ":" + linech.ch;
};

mirror = CodeMirror(document.body, { 
    onChange: function(_, change) { 
    }
});

});
</script>  
</head>
<body>
</body>
</html>
